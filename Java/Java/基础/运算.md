# Java 运算符与表达式

## 定义与作用

运算符是Java编程中用于执行各种运算操作的符号，表达式是由运算符和操作数组成的计算单元。通过运算符和表达式，程序可以实现各种数学计算、逻辑判断和数据处理功能。

**主要作用：**
- 执行数学计算和数值处理
- 实现逻辑判断和条件运算
- 进行位操作和内存操作
- 支持对象比较和赋值操作

## 算术运算符

### 1. 基本算术运算符

| 运算符 | 名称 | 示例 | 结果 |
|--------|------|------|------|
| `+` | 加法 | `5 + 3` | `8` |
| `-` | 减法 | `5 - 3` | `2` |
| `*` | 乘法 | `5 * 3` | `15` |
| `/` | 除法 | `5 / 2` | `2`（整数除法） |
| `%` | 取模 | `5 % 2` | `1` |

### 2. 复合赋值运算符

```java
int a = 10;
a += 5;    // a = a + 5 → 15
a -= 3;    // a = a - 3 → 12
a *= 2;    // a = a * 2 → 24
a /= 4;    // a = a / 4 → 6
a %= 5;    // a = a % 5 → 1
```

### 3. 自增自减运算符

```java
int a = 5;
int b = ++a;  // 前缀自增：a先加1，然后赋值给b → a=6, b=6
int c = a++;  // 后缀自增：a先赋值给c，然后加1 → a=7, c=6
int d = --a;  // 前缀自减：a先减1，然后赋值给d → a=6, d=6
int e = a--;  // 后缀自减：a先赋值给e，然后减1 → a=5, e=6
```

## 关系运算符

### 1. 基本关系运算符

| 运算符 | 名称 | 示例 | 结果 |
|--------|------|------|------|
| `==` | 等于 | `5 == 3` | `false` |
| `!=` | 不等于 | `5 != 3` | `true` |
| `>` | 大于 | `5 > 3` | `true` |
| `<` | 小于 | `5 < 3` | `false` |
| `>=` | 大于等于 | `5 >= 5` | `true` |
| `<=` | 小于等于 | `5 <= 3` | `false` |

### 2. 对象比较

```java
String str1 = "hello";
String str2 = "hello";
String str3 = new String("hello");

System.out.println(str1 == str2);        // true（字符串常量池）
System.out.println(str1 == str3);        // false（不同对象引用）
System.out.println(str1.equals(str3));   // true（内容相同）
```

## 逻辑运算符

### 1. 基本逻辑运算符

| 运算符 | 名称 | 示例 | 结果 |
|--------|------|------|------|
| `&` | 逻辑与（非短路） | `true & false` | `false` |
| `&&` | 逻辑与（短路） | `true && false` | `false` |
| `|` | 逻辑或（非短路） | `true | false` | `true` |
| `||` | 逻辑或（短路） | `true || false` | `true` |
| `!` | 逻辑非 | `!true` | `false` |
| `^` | 逻辑异或 | `true ^ false` | `true` |

### 2. 短路与非短路区别

```java
// 短路运算符：如果第一个条件为false，第二个条件不会执行
boolean result1 = (false && (5/0 == 0));  // 不会抛出异常

// 非短路运算符：两个条件都会执行
// boolean result2 = (false & (5/0 == 0));  // 会抛出ArithmeticException

// 短路运算符：如果第一个条件为true，第二个条件不会执行
boolean result3 = (true || (5/0 == 0));   // 不会抛出异常

// 非短路运算符：两个条件都会执行
// boolean result4 = (true | (5/0 == 0));   // 会抛出ArithmeticException
```

## 位运算符

### 1. 基本位运算符

| 运算符 | 名称 | 示例 | 结果（二进制） |
|--------|------|------|----------------|
| `&` | 按位与 | `5 & 3` | `101 & 011 = 001` → `1` |
| `|` | 按位或 | `5 | 3` | `101 | 011 = 111` → `7` |
| `^` | 按位异或 | `5 ^ 3` | `101 ^ 011 = 110` → `6` |
| `~` | 按位取反 | `~5` | `~00000101 = 11111010` → `-6` |
| `<<` | 左移 | `5 << 1` | `101 << 1 = 1010` → `10` |
| `>>` | 右移 | `5 >> 1` | `101 >> 1 = 010` → `2` |
| `>>>` | 无符号右移 | `-5 >>> 1` | 最高位补0 |

### 2. 位运算应用示例

```java
// 判断奇偶
boolean isEven = (num & 1) == 0;

// 交换两个数（不使用临时变量）
int a = 5, b = 3;
a = a ^ b;
b = a ^ b;
a = a ^ b;

// 取绝对值
int abs = (num ^ (num >> 31)) - (num >> 31);

// 判断是否为2的幂
boolean isPowerOfTwo = (num & (num - 1)) == 0 && num > 0;
```

## 赋值运算符

### 1. 基本赋值运算符

```java
int a = 10;        // 简单赋值
int b, c, d;
b = c = d = 20;    // 链式赋值
```

### 2. 复合赋值运算符

```java
int x = 10;
x += 5;     // x = x + 5
x -= 3;     // x = x - 3
x *= 2;     // x = x * 2
x /= 4;     // x = x / 4
x %= 3;     // x = x % 3
x &= 15;    // x = x & 15
x |= 8;     // x = x | 8
x ^= 12;    // x = x ^ 12
x <<= 1;    // x = x << 1
x >>= 1;    // x = x >> 1
x >>>= 1;   // x = x >>> 1
```

## 条件运算符（三元运算符）

### 1. 基本语法

```java
// 语法：condition ? expression1 : expression2
int max = (a > b) ? a : b;
String result = (score >= 60) ? "及格" : "不及格";
```

### 2. 嵌套使用

```java
// 嵌套三元运算符
String grade = (score >= 90) ? "优秀" : 
               (score >= 80) ? "良好" : 
               (score >= 60) ? "及格" : "不及格";
```

## instanceof运算符

### 1. 基本用法

```java
Object obj = "hello";
String str = "world";

System.out.println(obj instanceof String);  // true
System.out.println(str instanceof Object); // true
System.out.println(obj instanceof Integer); // false
```

### 2. 类型检查应用

```java
public void process(Object obj) {
    if (obj instanceof String) {
        String str = (String) obj;
        System.out.println("字符串长度：" + str.length());
    } else if (obj instanceof Integer) {
        Integer num = (Integer) obj;
        System.out.println("数字平方：" + num * num);
    } else {
        System.out.println("不支持的类型");
    }
}
```

## equals和hashCode

### 1. equals方法

**默认实现：**
```java
public boolean equals(Object obj) {
    return (this == obj);  // 比较对象引用地址
}
```

**重写示例：**
```java
public class Person {
    private String name;
    private int age;
    
    @Override
    public boolean equals(Object obj) {
        if (this == obj) return true;
        if (obj == null || getClass() != obj.getClass()) return false;
        Person person = (Person) obj;
        return age == person.age && Objects.equals(name, person.name);
    }
}
```

### 2. hashCode方法

**作用：**
- 用于哈希表等数据结构
- 提高对象查找效率

**重写规则：**
```java
@Override
public int hashCode() {
    return Objects.hash(name, age);
}
```

### 3. equals和hashCode关系

**重要规则：**
- 如果两个对象equals相等，则它们的hashCode必须相等
- 如果两个对象hashCode相等，它们不一定equals相等
- 重写equals方法时，必须同时重写hashCode方法

## 运算符优先级

### 1. 优先级顺序（从高到低）

| 优先级 | 运算符 | 描述 |
|--------|--------|------|
| 1 | `()` `[]` `.` | 括号、数组下标、成员访问 |
| 2 | `++` `--` `!` `~` `+` `-` | 一元运算符 |
| 3 | `*` `/` `%` | 乘除取模 |
| 4 | `+` `-` | 加减 |
| 5 | `<<` `>>` `>>>` | 移位 |
| 6 | `<` `<=` `>` `>=` `instanceof` | 关系 |
| 7 | `==` `!=` | 相等 |
| 8 | `&` | 按位与 |
| 9 | `^` | 按位异或 |
| 10 | `|` | 按位或 |
| 11 | `&&` | 逻辑与 |
| 12 | `||` | 逻辑或 |
| 13 | `?:` | 条件运算符 |
| 14 | `=` `+=` `-=` `*=` `/=` `%=` | 赋值 |

### 2. 优先级示例

```java
int result = 5 + 3 * 2;        // 5 + 6 = 11（乘法优先级高于加法）
boolean flag = true || false && false;  // true（&&优先级高于||）
int value = (a > b) ? a : b + 1;       // 需要括号明确优先级
```

## 表达式求值

### 1. 表达式类型

```java
// 算术表达式
int sum = a + b * c;

// 逻辑表达式
boolean isValid = (age >= 18) && (hasLicense);

// 赋值表达式
int x = y = z = 10;

// 方法调用表达式
String result = calculateResult(input);
```

### 2. 表达式优化

```java
// 避免重复计算
// 不推荐
if (list != null && list.size() > 0 && list.get(0) != null) {
    // ...
}

// 推荐
if (list != null) {
    int size = list.size();
    if (size > 0) {
        Object first = list.get(0);
        if (first != null) {
            // ...
        }
    }
}
```

## 总结

Java运算符提供了丰富的运算能力，涵盖了算术、关系、逻辑、位运算等多个方面。关键要点包括：

- **算术运算符**：用于数学计算，注意整数除法和浮点数除法的区别
- **关系运算符**：用于比较操作，注意对象比较使用equals方法
- **逻辑运算符**：区分短路和非短路运算符的使用场景
- **位运算符**：用于底层操作和性能优化
- **运算符优先级**：理解优先级规则，必要时使用括号明确运算顺序
- **equals和hashCode**：遵循重写规则，确保对象比较的正确性

通过合理使用各种运算符，可以编写出高效、清晰的Java代码。在实际开发中，应根据具体需求选择合适的运算符，并注意运算符的优先级和结合性。

最后更新时间：2024-01-15