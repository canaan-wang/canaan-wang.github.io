# Java 类型与引用

## 定义与作用
Java 类型系统是 Java 语言的核心基础，定义了数据的存储方式和操作规则。类型系统包括基本类型和引用类型两大类，每种类型都有特定的内存分配方式和操作特性。引用类型进一步细分为强引用、软引用、弱引用和虚引用，用于控制对象的生命周期和垃圾回收行为。

## 基本类型

### 定义
基本类型是 Java 语言内置的原始数据类型，直接存储在栈内存中，具有固定的内存大小和取值范围。

### 分类与特性

#### 布尔类型
- **boolean**：表示真或假，只有两个值：true 和 false
- 大小：JVM 规范未明确规定，通常为 1 位或 1 字节

#### 数值类型
- **整数类型**：
  - byte：8 位，范围 -128 到 127
  - short：16 位，范围 -32768 到 32767
  - int：32 位，范围 -2^31 到 2^31-1（默认整数类型）
  - long：64 位，范围 -2^63 到 2^63-1，字面量需加 L 后缀
- **浮点类型**：
  - float：32 位，单精度浮点数，字面量需加 F 后缀
  - double：64 位，双精度浮点数（默认浮点数类型）

#### 字符类型
- **char**：16 位 Unicode 字符，范围 0 到 65535

### 默认值
基本类型在作为类成员变量时有默认值：
- 数值类型：0
- boolean：false
- char：'\u0000'

## 引用类型

### 定义
引用类型存储的是对象的引用（地址），实际对象存储在堆内存中。除基本类型和枚举外，Java 中的所有类型都是引用类型。

### 主要引用类型

#### 类（Class）
- **定义**：对象的抽象描述，用于表示一组对象的创建模板
- **方法**：
  - Java 方法参数传递为值传递，但传递的是对象的引用
  - 静态方法不可以调用非静态的方法、变量
- **变量**：
  - 静态变量：使用 static 修饰，属于类，所有实例共享
  - 实例变量：属于对象，每个对象间不共享

#### 接口（Interface）
- **定义**：定义一组抽象方法的契约，实现类必须实现这些方法
- **特性**：
  - 接口中的方法默认是 public abstract
  - 接口中的变量默认是 public static final
  - Java 8 开始支持默认方法和静态方法

#### 抽象类（Abstract Class）
- **定义**：包含抽象方法的类，不能实例化
- **特性**：
  - 可以有构造器
  - 可以包含具体实现的方法
  - 可以有成员变量

#### 枚举（Enum）
- **定义**：特殊的类，表示一组固定的常量
- **特性**：
  - 类型安全，编译时检查
  - 可以有自己的方法和构造函数
  - 实现了 Comparable 和 Serializable 接口

#### 数组（Array）
- **定义**：相同类型元素的集合
- **特性**：
  - 长度固定，创建后不能改变
  - 支持多维数组
  - 是对象，继承自 Object 类

## 包装类型

### 定义
包装类型是基本类型对应的类类型，用于在需要对象的场景中使用基本类型。

### 包装类型对应关系
| 基本类型 | 包装类型 |
|---------|---------|
| boolean | Boolean |
| byte    | Byte    |
| short   | Short   |
| int     | Integer |
| long    | Long    |
| float   | Float   |
| double  | Double  |
| char    | Character |

### 自动装箱与拆箱
- **自动装箱**：基本类型自动转换为对应的包装类型
- **自动拆箱**：包装类型自动转换为对应的基本类型
- **实现机制**：JDK 1.5 引入，编译时插入相应的方法调用

### 缓存机制
- **范围**：-128 到 127 的整数会被缓存
- **目的**：提高性能，避免重复创建对象
- **影响**：在此范围内的包装对象使用 == 比较可能返回 true

## 注解（Annotation）

### 定义
注解是 Java 5 引入的元数据机制，用于为代码提供附加信息。

### 常用注解

#### @Autowired（Spring 提供）
- **作用**：自动依赖注入
- **特性**：
  - 只能按类型注入
  - 默认要求依赖对象必须存在
  - 如果允许为 null，则设定 required=false

#### @Resource（JDK 提供）
- **作用**：依赖注入
- **特性**：
  - 默认按名称注入，也支持按类型注入
  - 装配顺序：
    1. 同时指定 name、type：从 Spring 上下文中找到唯一匹配的 bean
    2. 仅指定 name：从 Spring 上下文中找
    3. 仅指定 type：从上下文中找
    4. name、type 都没有：按照 byName 方式进行装配

#### 其他常用注解
- @Override：标记方法重写
- @Deprecated：标记已过时的方法
- @SuppressWarnings：抑制编译器警告

## 四种引用类型

### 定义与作用
Java 提供了四种引用类型，用于控制对象的生命周期和垃圾回收行为，实现内存的精细管理。

### 强引用（Strong Reference）
- **定义**：最常见的引用类型，通过 new 关键字创建
- **特性**：
  - 只要强引用存在，对象就不会被垃圾回收
  - 显式将引用赋值为 null 可以中断强引用
- **示例**：`Object obj = new Object();`

### 软引用（Soft Reference）
- **定义**：用于实现内存敏感的高速缓存
- **特性**：
  - 内存充足时，软引用对象不会被回收
  - 内存不足时，软引用对象会被回收
- **应用场景**：图片缓存、网页缓存等
- **示例**：`SoftReference<Object> softRef = new SoftReference<>(new Object());`

### 弱引用（Weak Reference）
- **定义**：比软引用更弱的引用类型
- **特性**：
  - 无论内存是否充足，只要发生 GC，弱引用对象就会被回收
  - 常用于实现规范化映射（canonicalizing mappings）
- **应用场景**：WeakHashMap、监听器列表等
- **示例**：`WeakReference<Object> weakRef = new WeakReference<>(new Object());`

### 虚引用（Phantom Reference）
- **定义**：最弱的引用类型，主要用于跟踪对象被垃圾回收的状态
- **特性**：
  - 虚引用无法获取到对象实例
  - 对象被回收时，虚引用会被加入到引用队列
  - 用于在对象被回收时执行清理操作
- **应用场景**：资源清理、内存泄漏检测
- **示例**：`PhantomReference<Object> phantomRef = new PhantomReference<>(new Object(), queue);`

## instanceof 运算符

### 定义
instanceof 是 Java 的二元运算符，用于测试对象是否是指定类型（类、接口、数组）的实例。

### 语法
```java
object instanceof Type
```

### 返回值
- true：对象是指定类型或其子类型的实例
- false：对象不是指定类型的实例，或者对象为 null

### 使用场景
1. **类型检查**：在类型转换前进行安全检查
2. **多态处理**：根据对象实际类型执行不同逻辑
3. **模式匹配**：Java 14 引入的模式匹配 instanceof

### 示例
```java
if (obj instanceof String) {
    String str = (String) obj;
    System.out.println(str.length());
}

// Java 14+ 模式匹配
if (obj instanceof String str) {
    System.out.println(str.length());
}
```

## 总结
Java 的类型系统提供了丰富的数据类型支持，从基本类型到复杂的引用类型，每种类型都有其特定的用途和内存管理方式。理解类型系统对于编写高效、安全的 Java 程序至关重要。

## 注意事项
1. 基本类型与包装类型的自动转换可能带来性能开销
2. 引用类型的比较应使用 equals() 方法而非 == 运算符
3. 合理使用四种引用类型可以优化内存使用
4. instanceof 运算符在继承层次较深时可能影响性能

最后更新时间：2024-01-15