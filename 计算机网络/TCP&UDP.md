## TCP
- 面向连接，提供可靠的双向数据流传输，且具有网络拥塞控制能力的 点对点 数据传输协议
### 应用场景
- 效率相对低，但是准确性要求高的场景。比如文件传输、邮件等
### 三次握手
- 1. C -> S 发送请求连接报文，SYN 置为 1，并随机选择一个客户端起始序号 seq = x。
- 2. S -> C 发送同意连接报文， SYN、ACK 均置为 1，确认序列号 ack = x+1 并随机选择一个服务端起始序号 seq = y。在本地为该连接分配 TCP 缓存和变量.
- 3. C -> S 发送确认报文，ACK 置为 1，ack = y + 1, 如果携带数据则 seq = x + 1, 不携带数据则 seq = x。在本地为该连接分配 TCP 缓存和变量。
- 为什么是三次握手而不是两次，站在 S 端的角度，1 可以证明 C -> S 网络正常通信，但是 2. 对于 S 来说不清楚 C 是否拿到报文，无法证明 S -> C 间网络是否正常，所以需要 3 来证明 S -> C 的网络通信
### 四次挥手
- 1. 客户端不需要向服务端发送数据时，C -> S 停止发送数据，发送连接释放报文，FIN 置为 1。
- 2. S -> C 发送确认报文 ACK = 1。此时 C -> S 的网络连接关闭，TCP 处于半连接状态
- 3. 服务端不需要向客户端发送数据时，S -> C 发送连接释放报文，FIN 置为 1
- 4. C -> S 发送确认报文， ACK = 1，此时连接还没有释放掉，等到计时器设置的 2MSL 后，客户端进入关闭状态
### 四次握手最后等待的 2MSL 的作用
- 为了保证 S 可以收到 ACK 报文，如果 S 未收到 ACK，则会重新发送 FIN 报文 在 2MSL 时间内。
### TCP 拥塞控制
- 接收窗口：根据当前缓存大小所许诺的最新窗口值
- 拥塞窗口：根据自己估算的网络拥塞程度而设置的窗口值
- 发送窗口值：取接收窗口、拥塞窗口中最小值
- 慢开始：TCP 连接好时，令拥塞窗口 = 1 ,后续每次接收到一个新的报文段将拥塞窗口翻倍。
- 拥塞避免：拥塞窗口大于等于慢开始最高限制 ssthresh 时，拥塞窗口每次加1。当检测到超时事件时，将 ssthresh 设置为拥塞窗口当前值的一半，同时将拥塞窗口设置为1
- 快重传：发送方连续收到三个重复的ACK报文时，立即重传对方尚未收到的报文段
- 快恢复：发送端收到连续三个重复的ACK时，调整拥塞窗口以及 ssthresh 为拥塞窗口当前值的一半
### 滑动窗口（有点不太对）
1. 发送窗口：维持一组允许发送的有序帧序号，用来发送方进行流量控制
- 发送端收到一个帧的确认才会向前移动一个帧的位置，如果发送窗口内没有帧则停止发送。
2. 接收窗口：维持一组允许接收的有序帧序号，用来控制数据帧接收
- 接收到的数据帧在接收窗口内才会收下该帧，否则一律丢弃。

### TCP 可靠性如何保证
- 采用顺序编号、ACK、超时重传等实现其可靠性。
- TCP 开始传送一个段时，将段插入到发送队列中，同时启动时钟。
- 如果接收到接收端对该段的 ACK 信息，将该段从队列中删除。
- 如果在时钟规定时间内， ACK 未返回，则重新发送这个段

## UDP
- 无连接，提供不可靠的单向报文传输，不具备网络拥塞控制能力的 多对多 数据传输协议
- 效率要求高，准确性要求低的场景。比如直播、视频电话等