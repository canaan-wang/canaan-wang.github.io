# Go 工具链

- [go build](#go-build)：构建包或模块，生成可执行或归档。
- [go run](#go-run)：临时编译并运行。
- [go test](#go-test)：单元、基准、模糊测试。
- [go fmt](#go-fmt)：格式化源码。
- [go vet](#go-vet)：静态检查常见错误用法。
- [go mod](#go-mod)：模块与依赖管理。
- [go get](#go-get)：获取/升级依赖（修改 `go.mod`）。
- [go work](#go-work)：多模块工作区。
- [go generate](#go-generate)：代码生成钩子。
- [go tool pprof](#go-tool-pprof)：性能剖析（CPU/内存/阻塞/协程）。
- [go tool trace](#go-tool-trace)：运行时事件追踪。
- [go doc](#go-doc)：查看包与符号文档。
- [go env](#go-env)：查看/设置 Go 环境变量。
- [go clean](#go-clean)：清理构建缓存与生成文件。
- [go list](#go-list)：列出包与依赖信息。
- [go install](#go-install)：安装可执行到 `GOBIN`（或 `$GOPATH/bin`）。

## go build

用途：构建包或模块，生成可执行或归档（`.a`）。

常用参数：
- `-o <file>` 指定输出文件名。
- `-v` 显示被编译的包。
- `-race` 启用数据竞争检测（部分平台）。
- `-tags <tags>` 指定构建标签。
- 交叉编译：设置 `GOOS`、`GOARCH`。

示例：
- `go build ./cmd/app`
- `GOOS=linux GOARCH=amd64 go build -o bin/app-linux ./cmd/app`

## go run

用途：编译并运行 Go 程序（临时执行）。

示例：
- `go run main.go`
- `go run ./cmd/app`（包路径）
- 传参：`go run main.go --port 8080`

## go test

用途：运行单元测试、基准测试、模糊测试。

常用参数：
- `-run <regex>` 选择性运行匹配的测试函数。
- `-bench <regex>` 运行匹配的基准测试（如 `-bench .`）。
- `-benchmem` 显示内存分配统计。
- `-count N` 指定重复次数（可配合 `-cpu`）。
- `-race` 启用数据竞争检测。
- `-fuzz <regex>` 启用模糊测试；`-fuzztime` 指定持续时间。

示例：
- 功能测试：`go test ./... -run TestLogin`
- 基准测试：`go test -bench . -benchmem ./pkg/...`
- 模糊测试：`go test -fuzz FuzzParse -fuzztime=30s ./...`

## go fmt

用途：格式化源码（约等于 `gofmt -w`）。

示例：
- `go fmt ./...`
- `go fmt ./pkg/mylib`

## go vet

用途：静态检查常见错误用法（非风格检查）。

示例：
- `go vet ./...`
- `go vet -vettool=/path/to/custom-vet ./pkg/...`

## go mod

用途：模块与依赖管理。

子命令：
- `go mod init <module>` 初始化模块。
- `go mod tidy` 整理依赖（添加缺失、移除未用）。
- `go mod vendor` 生成 `vendor/` 依赖副本。
- `go mod download` 预下载依赖到缓存。
- `go mod edit` 编辑 `go.mod`（高级用法）。

示例：
- `go mod init github.com/user/project`
- `go mod tidy`

## go get

用途：获取/升级依赖（Go 1.17+：修改 `go.mod`）。

示例：
- 升级到最新次要版本：`go get example.com/lib@latest`
- 固定版本：`go get example.com/lib@v1.2.3`

## go work

用途：多模块工作区，统一开发与构建。

子命令：
- `go work init [dirs]` 初始化并添加模块路径。
- `go work use <dir>` 添加或移除模块路径（配合 `-r`）。
- `go work edit` 编辑 `go.work`。

示例：
- `go work init ./moduleA ./moduleB`
- `go work use ./moduleC`

## go generate

用途：运行源代码中声明的生成指令。

约定：在源文件中写注释 `//go:generate <command>`。

示例：
- 源文件：`//go:generate stringer -type=Color`
- 运行：`go generate ./...`

## go tool pprof

用途：性能剖析（CPU/内存/阻塞/协程），结合 `net/http/pprof` 或生成的 `*.pprof` 文件。

常用用法：
- 在线服务：`go tool pprof http://localhost:6060/debug/pprof/profile?seconds=30`
- 离线文件：`go tool pprof cpu.pprof`
- 交互命令：`top`、`list <func>`、`web`（需 Graphviz）、`svg`、`png`。

采集：
- 引入 `import _ "net/http/pprof"` 并在服务上开启 `:6060` 监听。

## go tool trace

用途：运行时事件追踪，可视化调度、GC、网络等事件。

示例：
- 采集：`go test -trace trace.out ./pkg/...`
- 查看：`go tool trace trace.out`

## go doc

用途：在终端查看文档与符号说明。

示例：
- `go doc net/http`
- `go doc -all bytes`
- `go doc -src net/http.Server`

## go env

用途：查看或设置 Go 环境变量。

示例：
- `go env` 列出全部。
- `go env GOPATH GOMODCACHE GOOS GOARCH`

## go clean

用途：清理构建缓存与生成文件。

示例：
- `go clean -cache -testcache -modcache`
- `go clean -i`（移除已安装的包/二进制）

## go list

用途：列出包与依赖图信息，支持模板输出。

示例：
- `go list ./...`
- `go list -deps ./cmd/app`
- `go list -json ./pkg/mylib`

## go install

用途：安装可执行文件到 `GOBIN`（或 `$GOPATH/bin`）。

示例：
- 从模块安装：`go install example.com/cmd/tool@latest`
- 指定版本：`go install example.com/cmd/tool@v1.2.3`