## OSI 七层网络模型
### 物理层
- 功能：为数据端设备透明传输数据流。
- 设备：中继器，集线器
### 数据链路层
- 功能: 将IP数据报组装成帧交友物理层传输，通过检测、矫正物理层产生的传输差错，使得链路对网络层是一条无差错、可靠的数据传输线路。
- 设备: 网桥，交换机
### 网络层
- 功能：将数据封装成数据报，通过路由为网络上的不同主机提供通信服务。
- 协议: IP,ICMP,ARP
- 设备: 路由器
### 传输层
- 功能：负责主机中进程间通信。
- 协议：TCP,UDP
### 会话层
- 功能：负责计算机软件的通信能力
- 协议：RPC、TLS、SSL
### 表示层
- 功能：负责计算机软件间通信时的数据流表示形式（加密、压缩）
### 应用层
- 功能：直接为应用进程服务。
- 协议：FTP(21) DNS(53) HTTP(80) DHCP(动态主机配置协议)

## OSI 五层模型
- 表示层、会话层、传输层统称为运输层

## TCP
- 面向连接，提供可靠的双向数据流传输，且具有网络拥塞控制能力的 点对点 数据传输协议
### 应用场景
- 效率相对低，但是准确性要求高的场景。比如文件传输、邮件等
### 三次握手
- 1. C -> S 发送请求连接报文，SYN 置为 1，并随机选择一个客户端起始序号 seq = x。
- 2. S -> C 发送同意连接报文， SYN、ACK 均置为 1，确认序列号 ack = x+1 并随机选择一个服务端起始序号 seq = y。在本地为该连接分配 TCP 缓存和变量.
- 3. C -> S 发送确认报文，ACK 置为 1，ack = y + 1, 如果携带数据则 seq = x + 1, 不携带数据则 seq = x。在本地为该连接分配 TCP 缓存和变量。
- 为什么是三次握手而不是两次，站在 S 端的角度，1 可以证明 C -> S 网络正常通信，但是 2. 对于 S 来说不清楚 C 是否拿到报文，无法证明 S -> C 间网络是否正常，所以需要 3 来证明 S -> C 的网络通信
### 四次挥手
- 1. 客户端不需要向服务端发送数据时，C -> S 停止发送数据，发送连接释放报文，FIN 置为 1。
- 2. S -> C 发送确认报文 ACK = 1。此时 C -> S 的网络连接关闭，TCP 处于半连接状态
- 3. 服务端不需要向客户端发送数据时，S -> C 发送连接释放报文，FIN 置为 1
- 4. C -> S 发送确认报文， ACK = 1，此时连接还没有释放掉，等到计时器设置的 2MSL 后，客户端进入关闭状态
### 四次握手最后等待的 2MSL 的作用
- 为了保证 S 可以收到 ACK 报文，如果 S 未收到 ACK，则会重新发送 FIN 报文 在 2MSL 时间内。
### TCP 拥塞控制
- 接收窗口：根据当前缓存大小所许诺的最新窗口值
- 拥塞窗口：根据自己估算的网络拥塞程度而设置的窗口值
- 发送窗口值：取接收窗口、拥塞窗口中最小值
- 慢开始：TCP 连接好时，令拥塞窗口 = 1 ,后续每次接收到一个新的报文段将拥塞窗口翻倍。
- 拥塞避免：拥塞窗口大于等于慢开始最高限制 ssthresh 时，拥塞窗口每次加1。当检测到超时事件时，将 ssthresh 设置为拥塞窗口当前值的一半，同时将拥塞窗口设置为1
- 快重传：发送方连续收到三个重复的ACK报文时，立即重传对方尚未收到的报文段
- 快恢复：发送端收到连续三个重复的ACK时，调整拥塞窗口以及 ssthresh 为拥塞窗口当前值的一半
### 滑动窗口（有点不太对）
1. 发送窗口：维持一组允许发送的有序帧序号，用来发送方进行流量控制
- 发送端收到一个帧的确认才会向前移动一个帧的位置，如果发送窗口内没有帧则停止发送。
2. 接收窗口：维持一组允许接收的有序帧序号，用来控制数据帧接收
- 接收到的数据帧在接收窗口内才会收下该帧，否则一律丢弃。

### TCP 可靠性如何保证
- 采用顺序编号、ACK、超时重传等实现其可靠性。
- TCP 开始传送一个段时，将段插入到发送队列中，同时启动时钟。
- 如果接收到接收端对该段的 ACK 信息，将该段从队列中删除。
- 如果在时钟规定时间内， ACK 未返回，则重新发送这个段

## UDP
- 无连接，提供不可靠的单向报文传输，不具备网络拥塞控制能力的 多对多 数据传输协议
- 效率要求高，准确性要求低的场景。比如直播、视频电话等

## HTTP
### Get
- 用于信息获取，应该是安全的和幂等的
- Get 请求的数据会附在 URL 之后
- 安全性较低
- 传输的数据量较小（2083 个字符）
### Post
- 可能修改变服务器上的资源的请求
- Post 提交的数据放在 http 请求体中
- 安全性较高
- 可以传输的数据量比较大
### 常见错误码
2xx 成功：
200 OK：一切正常
3xx 重定向：
301 Moved Permanently: 客户请求的文档在其他地方
4xx 客户机中出现的错误
400 Bad Request: 请求出现语法错误。
401 Unauthorized: 客户试图未经授权访问受密码保护的页面。
403 Forbidden: 资源不可用,服务器理解客户的请求，但拒绝处理它。通常由于服务器上文件或目录的权限设置导致。
404 Not Found: 无法找到指定位置的资源。这也是一个常用的应答。
5xx 服务器中出现的错误:
500 Internal Server Error: 服务器遇到了意料不到的情况，不能完成客户的请求。
501 Not Implemented 服务器不支持实现请求所需要的功能。例如，客户发出了一个服务器不支持的PUT请求。
502 Bad Gateway: 服务器作为网关或者代理时，为了完成请求访问下一个服务器，但该服务器返回了非法的应答。
503 Service Unavailable: 服务器由于维护或者负载过重未能应答。
504 Gateway Timeout: 由作为代理或网关的服务器使用，表示不能及时地从远程服务器获得应答。
505 HTTP Version Not Supported:服务器不支持请求中所指明的HTTP版本。（HTTP 1.1新）
### Http1.1 和 Http 1.0 的区别
- Http1.0 短连接：每次请求都需要建立一次 TCP 连接，如果网页需要多个图片则需要建立多次 Http 连接
- Http1.1 长连接：支持一个TCP连接上可以传送多个HTTP请求和响应，减少了建立和关闭连接的消耗和延迟。采用流水线的持久连接，不需要等待请求返回就可以发送下一次请求。但是服务端需要按序返回。
- Http1.0 不支持Host请求头字段，无法支持一个主机上的多个虚拟 web 站点
- Http1.1 新增 Host 请求字段，支持一个主机上的多个虚拟 web 站点
- Http1.1 还提供了与身份认证、状态管理和Cache缓存等机制相关的请求头和响应头
- Http1.1 增加了OPTIONS方法，它允许客户端获取一个服务器支持的方法列表
### Http1.1 长连接
- 服务端在响应头中加入 Connection:keep-alive
- 当一个网页打开完成后，客户端和服务器之间用于传输HTTP数据的 TCP连接不会关闭，如果客户端再次访问这个服务器上的网页，会继续使用这一条已经建立的连接。
- 实现长连接要客户端和服务端都支持长连接。
### Https 如何进行加密
- HTTPS(Secure Hypertext Transfer Protocol)安全超文本传输协议
- 使用 SSL 在发送方把原始数据进行加密，然后在接受方进行解密保证数据的安全性
- 默认端口 443
### Http 与 Https 的区别
- http是HTTP协议运行在TCP之上。
- https是HTTP运行在SSL/TLS之上，SSL/TLS运行在TCP之上。
- http是超文本传输协议，信息是明文传输
- https 则是具有安全性的ssl加密传输协议

## SSL
### 四次握手
- 1. C -> S 发送加密通信请求，包含客户端随机数1、支持的加密方式、支持的压缩方式
- 2. S -> C 发送应答，包含加密协议版本、加密方法、服务器证书(CA)、服务端随机数1
- 3. C 验证 CA、从 CA 中取出公钥，C -> S 发送客户端随机数2，编码改变通知(表示使用约定的加密、密钥进行数据传输)、客户端握手结束通知
- 4. S 服务端使用三个随机数计算回话密钥，S -> C 发送编码改变通知，服务器握手结束通知
- 使用三个随机数的原因，现在的随机数都是伪随机，通过三个随机数的方式增加随机数的复杂度。

### TLS
- 是一种为应用程序提供数据安全及完整性的网络协议，在浏览器、邮箱、即时通信等领域广泛支持。主流网站均使用该协议进行网络连接及通信。
- 采用 CS模式（客户端-服务器），在两端建立安全的网络连接，防止数据传输时受到窃听、篡改
- TLS 与应用层协议（HTTP、FTP 等）无耦合，应用层数据通过 TLS 是均会被加密。
- TLS 连接创建：（CS 两端握手以创建一个有状态的网络连接）
    - C -> S：要求创建安全连接，并列出密码算法列表（加密算法、散列算法）
    - S -> C：决策使用的密码算法，并通知 C
    - S -> C：发送数字证书（包含服务器公钥、服务器名称、证书颁发机构）
    - C：验证数字证书有效性
    - C -> S：生成会话密钥，并发送到服务器（密钥生成：使用服务器公钥加密随机生成的密钥，服务器使用私钥进行解密）
- TLS 握手过程中的数据安全通过 临时Diffie-Hellman、临时椭圆曲线Diffie-Hellman 提供前向保密能力。
